 /******************************************************
 * PLEASE DO NOT EDIT THIS FILE
 * the verification process may break
 * ***************************************************/

'use strict';

var express = require('express');
var request = require('request');
var bodyParser = require('body-parser');

var app = express();

app.use('/public', express.static(process.cwd() + '/public'));
app.use(bodyParser.json());
  
app.route('/')
    .get(function(req, res) {
		  res.sendFile(process.cwd() + '/views/index.html');
    })

// app.get('/api/imagesearch/:search', function(req, res){
//   var url = 'https://www.googleapis.com/customsearch/v1?key=' + process.env.KEY + '&cx=' + process.env.CX + '&searchType=image&start=' + (req.query.offset || '1') + '&q='+req.params.search;
//   request({
//     url: url,
//     json: true
//   }, function(err, responce, body){
    
//   })
// res.end()
// })

app.get('/api/imagesearch/:search', function(req, res){
  
  getJSON(req.query.offset, req.params.search, function(data){
    res.send(data.items)
  })

res.end()
})

function getJSON(search, offset, callback){
    var url = 'https://www.googleapis.com/customsearch/v1?key=' + process.env.KEY + '&cx=' + process.env.CX + '&searchType=image&start=' + (offset || '1') + '&q='+search;
  request({
    url: url,
    json: true
  }, function(err, responce, body){
    callback(body)
  })
}

app.listen(process.env.PORT, function () {
  console.log('Node.js listening ...');
});

